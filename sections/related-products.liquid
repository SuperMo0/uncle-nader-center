{{ 'product-card.css' | asset_url | stylesheet_tag }}
{{ 'animation.css' | asset_url | stylesheet_tag }}
<script src="{{ 'animation-observer.js' | asset_url }}" defer="defer"></script>

<div class="product-section related-products-section">
  <div class="page-width">
    <h2 class="related-products__title h2 ammo-animate-on-scroll ammo-fade-in-up">منتجات قد تعجبك</h2>

    <div class="related-products__grid">
      {%- liquid
        assign limit = 4
        assign current_product = product
        assign counter = 0
      -%}

      {% assign rel_collection = product.collections.first %}
      {% unless rel_collection %}
        {% assign rel_collection = collections.all %}
      {% endunless %}

      {% for item in rel_collection.products %}
        {% if item.id == current_product.id %}{% continue %}{% endif %}
        {% if counter >= limit %}{% break %}{% endif %}

        {% assign counter = counter | plus: 1 %}
        {% comment %} Calculate delay based on loop index to create ripple effect (1, 2, 3, 4) {% endcomment %}
        {% assign delay_index = counter | modulo: 4 %}
        {% if delay_index == 0 %}{% assign delay_index = 4 %}{% endif %}

        {% render 'product-card', product: item, index: delay_index %}
      {% endfor %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Related Products",
  "tag": "section",
  "class": "section",
  "settings": [],
  "presets": [
    {
      "name": "Related Products"
    }
  ]
}
{% endschema %}
